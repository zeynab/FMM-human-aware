\section{Human aware Navigation Model}
%\dv{Sections 3 and 4 can be used to explain our model. First the perception and then the human aware navigation model. Don't spend too much time explaining the background of these methods. Make that brief and explain more on our approaches. It is a bit confusing when you split social path planning and navigation. I feel its better to have it under the same section. We have one Human aware navigation model which could have a subsection for social cost and such and another for navigation(FMM,DWA).}



The model used for achieving human-aware navigation, mainly consists of accounting for social costs in the planners. In this work we focus on modelling social costs based on the proxemics principle, targeted for real robotic applications in the presence of noisy perception. These costs are then used in an FMM-based global planner, resulting in trajectories that respect social considerations. However, we extend the deterministic model of social costmaps, for taking the uncertainty of perception into account. For this purpose, three different methods have been proposed in combination with a probabilistic tracker, for obtaining uncertainty-based social costs. 

Our goal is to show that the assumption of having perfect information about the state of the human is unrealistic and in real situations when the robot has to deal with uncontrolled environments, the uncertainty in this information can not be ignored. We can think of false negative detections where the robot misses to take an person into consideration, false positive detections where other objects are detected as humans, noisy estimations of position, orientation, velocity of the person, etc. %To the best of our knowledge, there does not exit any work on including uncertainty of perception in the social costs model.

\subsection{Navigation Framework}

Navigation in this context is understood as the capability of a robot to move autonomously in the environment with the goal of reaching a pre-specified final pose. The time taken by the robot to execute this task should be minimal, while avoiding collisions with obstacles as well as maintaining a certain clearance to them. In this paper we take the classical approach of dividing navigation into self-localization and guidance, assuming knowledge of a map of the environment. We also assume that unmapped static or moving obstacles may appear in the environment, while the robot is expected to deal with them in an appropriate way. We further assume an existing self-localization system (AMCL \cite{amcl}), based on data fusion of odometry and range sensor matching with the map. 

The guidance problem is approached as a two step process. First, given a goal location, the robot plans its path from the current pose to the goal pose. This is the task of our FMM-based global planner. Second, the plan is executed by the robot, in real time, while avoiding unmapped obstacles. This is done by means of a local path planner based on DWA \cite{fox1997dynamic}. More details on the navigation can be found in \cite{ventura2015}.

\subsection{Social Costs}


\dv{rewrite this in a way that we dont model orientation, but people do that too and its a possible but not mandatory part of our work.}The personal space around a human can be defined as the mixture of two pseudo-Gaussian functions, one for the front and another one for the rear part of the area surrounding the person. The orientation and heading of the person will cause a corresponding rotation in these functions in such a way that the person is always in the center and the absolute orientation of the person matches that of the Gaussian functions. 
A Gaussian function $\phi$, centred on $p$ with covariance matrix $\Sigma$, is defined as follows:

\begin{equation}
\phi(q) = exp(-\frac{1}{2}(q-p)\Sigma^{-1}(q-p))
\end{equation}

$q$ indicates the position of a point and $\Sigma$ is:
\begin{equation}
\Sigma = \begin{pmatrix}
{\sigma}_{x}^2  & 0\\ 
 0& {\sigma}_{y}^2 
\end{pmatrix}
\end{equation}

${\sigma}_{x}$ and ${\sigma}_{y}$ are used to modulate the shape of the Gaussian and are traditionally chosen in a way to respect the personal space of a person as indicated by the proxemics principle. Various factors such as gender, age, speed of the human motion \cite{kirby2009companion} can influence the size of this area, however ${\sigma}_{x}$ and ${\sigma}_{y}$ are commonly considered to be constant. Getting closer to a person, will cause an increase in the value of the function, and hence the social cost associated to that position will increase.

If the center of the costmap, which indicates the position of the person in not deterministically known, the costmap can not correctly model the social costs and hence the social path planning could fail in finding an appropriate socially compliant path. This problem becomes much more critical in real applications where robustness is vital for succeeding under different conditions. We believe probabilistic social costs can be a remedy to this problem. 


In the following we will go into the details of computing social costs with different methods. Regardless of the methods used for obtaining these costs, by profiting from the concept of layered costmaps similar to \cite{lu2014iros}, FMM will utilize this information for performing the replanning step. 
%FMM computes the optimal path for the robot for a given destination, according to a potential filed created by the setting of obstacles in an environment based on wave propagation principles. In our system, social costs are incorporated into the FMM method when computing the optimal path by means of imposing them as virtual obstacles.


\subsubsection{Deterministic Social Costs}

This is the conventional costmap model used in the literature, where it is assumed that the position and orientation of the person is deterministically known at every time step with no error. Once this information is known, the conventional Gaussian shaped costmap can be used to obtain the social costs. This costmap can be tuned according to the desired parameters such as age, gender, velocity of the human, etc. In this paper, we have taken an approach similar to \cite{gomez2013social} with ${\sigma}_{x} = 0.255\ m$, for deterministic costmaps. 


%However, we only consider the position of the person, and not the orientation.
%The reason for this choice, is the insufficient reliability of the tracking for correctly reporting the orientation of a person, using only an omni-directional overhead camera for our real experiments. However, this model can be easily extended to include the orientation of the person, which causes a rotation in the current costmap. Additionally, the uncertainty of position and orientation are better solved if we have decoupled models for them. Hence, we only focus on the uncertainty of position in this paper. 

In this paper, we focus on the social costmaps based solely on the position of the persons present in the environment. For deterministic social costs, this information is given by a deterministic tracker \dv{havent explained det. tracker} at each time step, and upon receiving this information the social costmap layer is updated. This approach is easily scalable for including multiple people.

\subsubsection{Uncertainty-based Social Costs}

To include the uncertainty of perception in our model, we need to have an estimate of the underlying distribution of people present in the environment at each time step. This is given by the MCMC based tracker, that provides samples of the \textit{union} of the probability distributions for having a person in a given environment. More specifically, a predefined number of samples are reported at each time step for each person that the tracker detects. In the following, we propose two type of methods for using these samples to create social costmaps.  

\subsubsection*{Convolution}

The core idea we propose for incorporating uncertainty in the costmap is to compute an \textit{expectation} based costmap. In other words, we treat the probability map of the presence of people in the environment as a two dimensional signal and convolve it with the conventional Gaussian costmap, to obtain the final probabilistic social costs. By convolving all the samples from the MCMC tracker with the social costmap, we compute an \textit{expected costmap} incorporating all the uncertainty in the environment. This is a principled approach to solve the problem since we are not abstracting away any information provided by the perception system and hence in theory should provide us with a costmap model that would be most informative for uncertainty-based human-aware navigation.

%We can compute the convolution of the estimate of the underlying distribution for the presence of people in an environment, by the conventional social costmap to get the final social cost for each position of the map.


%There are two main steps required for acquiring the final costmap of the environment using this approach. 1) Create a probability map for the presence of people in the environment, 2) by convolving this probability map with the Gaussian-shaped social costmap for an individual person, obtain the final social costmap that contains the social costs related to all the people present in the environment.
   
By taking this approach, the conventional 2D Gaussian shape of the social costmap is no longer mandatory, thus this costmap model is more flexible. Additionally, there is no need to know the number of people ahead of time as the samples given by tracker are reflecting this (refer to \ref{MCMC}). \dv{add a picture somewhere of how the cost map looks}



\subsubsection*{Clustering}
Another approach we propose is to abstract the uncertainty information in the samples by clustering the particles and then computing the uncertainty, based on the features of the cluster. Upon receiving the position samples from the tracker we compute the center of the social costmaps, and the ${\sigma}$ values for all the people present in the environment. By clustering the samples and finding the centroids of the clusters, along with an uncertainty measure based on the spatial cluster scatter, we can adaptively compute the social costmaps at each time step. We will briefly describe the two clustering methods selected for our work in the following.
\paragraph{K-means clustering}

Kmeans clustering \cite{hartigan1979algorithm} method for can be adopted for computing the costmap centers and $\Sigma$. However, one requirement for using this method is knowing K which is the number of clusters and in our case the number of people, ahead of time. This is not a realistic assumption for dynamic environments with multiple people. Nonetheless, we will test this method as a baseline for comparing the performances of other human-aware navigation methods both in simulation and reality.

\paragraph{Mean shift clustering}
To overcome the limitation of Kmeans clustering method for needing to know the number of clusters ahead of time, we chose another clustering method, mean shift clustering \cite{comaniciu2002mean}, that is able to determine the number of clusters given the sample set automatically. We used the median of all pairwise distances to estimate the bandwidth of mean shift method.



